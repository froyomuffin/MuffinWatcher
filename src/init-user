#!/bin/bash

SCRIPTDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)" # http://stackoverflow.com/questions/59895/can-a-bash-script-tell-what-directory-its-stored-in

source $SCRIPTDIR/CONFIG

# SUBSCRIBERSTORE is loaded from the CONFIG

NAME=$1
NEWSUBSCRIBERDIR="$SUBSCRIBERSTORE/$NAME"

if [[ -z "$NAME" ]]
then
    echo "Please specify a subscriber name"
    exit 1
fi

if [[ ! -d "$SUBSCRIBERSTORE" ]]
then
    mkdir -p $SUBSCRIBERSTORE
fi

if [[ -d "$NEWSUBSCRIBERDIR" ]]
then
    echo "Subscriber $NAME already exists!"
    exit 1
else 
    echo "Creating subscriber $NAME"

    mkdir -p $NEWSUBSCRIBERDIR

    # TODO: Description messages directly in the files
    touch $NEWSUBSCRIBERDIR/notifiers

    echo '#!/bin/bash' >  $NEWSUBSCRIBERDIR/version-change
    echo '# Autogenerated script to handle version updates' >>  $NEWSUBSCRIBERDIR/version-change
    echo '# Add logic here if your subscriber needs special handling' >>  $NEWSUBSCRIBERDIR/version-change

    chmod +x $NEWSUBSCRIBERDIR/version-change
fi
